@page "/dashboard/admin"
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Policy = "AdminOnly")]
@using Microsoft.EntityFrameworkCore
@using ClinicQueueSystem.Data
@inject ApplicationDbContext Db

<PageTitle>Admin Dashboard</PageTitle>

<div class="container" style="padding: 2rem 0;">
    <h2 style="color:#2C5F8D;">Admin Dashboard</h2>

    @if (loading)
    {
        <div class="text-center py-5"><div class="spinner-border text-primary" /></div>
    }
    else
    {
        <div class="row g-3">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <div class="fs-1 fw-bold">@totalPatients</div>
                        <div class="text-muted">Patients</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <div class="fs-1 fw-bold">@totalProviders</div>
                        <div class="text-muted">Providers</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <div class="fs-1 fw-bold">@todaysAppointments</div>
                        <div class="text-muted">Today's Appointments</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <div class="fs-1 fw-bold">@activeQueue</div>
                        <div class="text-muted">Checked-In</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3">
            <a class="btn btn-outline-primary btn-sm" href="/providers">Manage Providers</a>
            <a class="btn btn-outline-secondary btn-sm ms-2" href="/patients">Manage Patients</a>
            <a class="btn btn-outline-success btn-sm ms-2" href="/appointments">View Appointments</a>
        </div>
    }
</div>

@code {
    private bool loading = true;
    private int totalPatients, totalProviders, todaysAppointments, activeQueue;

    protected override async Task OnInitializedAsync()
    {
        totalPatients = await Db.Patients.CountAsync();
        totalProviders = await Db.Providers.CountAsync();
        var start = DateTime.Today;
        var end = start.AddDays(1);
        todaysAppointments = await Db.Appointments.CountAsync(a => a.ScheduledDateTime >= start && a.ScheduledDateTime < end);
        activeQueue = await Db.QueueTickets.CountAsync(q => q.Status != "Completed");
        loading = false;
    }
}


